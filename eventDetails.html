<!DOCTYPE html>
<html lang="ar" dir="rtl">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ØªÙØ§ØµÙŠÙ„ Ø§Ù„ÙØ¹Ø§Ù„ÙŠØ©</title>
    <style>
      body {
        font-family: "Tahoma", sans-serif;
        background-color: #f4f4f4;
        margin: 0;
        padding: 0;
        color: #333;
      }
      header {
        background-color: #0288d1;
        color: white;
        padding: 1rem;
        text-align: center;
        position: relative;
      }
      .container {
        max-width: 900px;
        margin: 20px auto;
        background: white;
        padding: 20px;
        border-radius: 10px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      }
      .share-button-top {
        position: absolute;
        top: 15px;
        left: 15px;
        background-color: white;
        color: #0288d1;
        border: none;
        border-radius: 50%;
        width: 40px;
        height: 40px;
        font-size: 20px;
        cursor: pointer;
        box-shadow: 0 0 5px rgba(0, 0, 0, 0.2);
      }
      .share-button-top:hover {
        background-color: #e0f3fc;
      }
      .heart-button {
        position: absolute;
        top: 15px;
        left: 70px;
        background-color: white;
        color: #0288d1;
        border: none;
        border-radius: 50%;
        width: 40px;
        height: 40px;
        font-size: 20px;
        cursor: pointer;
        box-shadow: 0 0 5px rgba(0, 0, 0, 0.2);
      }
      .heart-button.liked {
        color: red;
      }
      .heart-button:hover {
        background-color: #e0f3fc;
      }
      .images {
        display: block;
        margin-bottom: 20px;
      }
      .images img {
        width: 100%;
        height: 400px;
        object-fit: cover;
        border-radius: 8px;
      }
      .description {
        margin-top: 20px;
        line-height: 1.8;
      }
      .info-row {
        margin-top: 10px;
        font-size: 16px;
        color: #555;
      }
      .info-label {
        font-weight: bold;
        color: #0288d1;
        margin-left: 5px;
      }
      .map {
        margin-top: 20px;
        height: 350px;
        border-radius: 8px;
        overflow: hidden;
      }
      iframe {
        width: 100%;
        height: 100%;
        border: 0;
      }
      .comments {
        margin-top: 30px;
      }
      .comments h3 {
        color: #0288d1;
      }
      .comments ul {
        list-style: none;
        padding: 0;
      }
      .comments li {
        background-color: #f0f0f0;
        margin: 10px 0;
        padding: 10px;
        border-radius: 5px;
      }
      .comment-form {
        display: flex;
        flex-direction: column;
        margin-top: 10px;
      }
      .comment-form textarea {
        resize: none;
        padding: 10px;
        font-size: 14px;
        border-radius: 5px;
        border: 1px solid #ccc;
      }
      .comment-form button {
        margin-top: 10px;
        padding: 10px;
        background-color: #0288d1;
        color: white;
        border: none;
        border-radius: 5px;
        cursor: pointer;
      }
      .comment-form button:hover {
        background-color: #0271a8;
      }
      .action-buttons {
        margin-top: 20px;
        text-align: center;
      }
      .action-buttons a {
        text-decoration: none;
        background-color: #0288d1;
        color: white;
        padding: 12px 25px;
        border-radius: 8px;
        font-size: 16px;
        display: inline-block;
        margin: 10px;
        transition: background-color 0.3s ease;
      }
      .action-buttons a:hover {
        background-color: #0271a8;
      }
      .rating-section {
        margin-top: 30px;
        text-align: right;
      }
      #star-rating {
        direction: ltr;
        display: inline-block;
        margin-top: 10px;
      }
      #star-rating .star {
        font-size: 35px;
        cursor: pointer;
        color: #ccc;
        transition: color 0.2s;
        display: inline-block;
      }
      #star-rating .star.selected {
        color: gold;
      }
      #rating-result {
        margin-top: 10px;
        font-weight: bold;
        color: green;
      }
      .price-section {
        background: linear-gradient(135deg, #0288d1, #26c6da);
        color: white;
        padding: 20px;
        border-radius: 15px;
        text-align: center;
        margin: 20px 0;
        box-shadow: 0 4px 15px rgba(2, 136, 209, 0.2);
      }
      .price-section .price-label {
        font-size: 18px;
        margin-bottom: 10px;
        opacity: 0.9;
      }
      .price-section .price-amount {
        font-size: 32px;
        font-weight: bold;
        text-shadow: 0 2px 4px rgba(0,0,0,0.1);
      }
      .price-section .currency {
        font-size: 24px;
        margin-right: 5px;
      }
    </style>
  </head>
  <body>
    <header>
      <h1 id="event-title">ØªÙØ§ØµÙŠÙ„ Ø§Ù„ÙØ¹Ø§Ù„ÙŠØ©</h1>
      <button class="share-button-top" onclick="shareActivity()" title="Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„ÙØ¹Ø§Ù„ÙŠØ©">
        ğŸ“¤
      </button>
      <button class="heart-button" onclick="toggleLike()" title="Ø¥Ø¹Ø¬Ø§Ø¨">
        ğŸ¤
      </button>
    </header>

    <div class="container">
      <div id="images-container" class="images">
        <!-- Ø§Ù„ØµÙˆØ± Ø³ØªØ¶Ø§Ù Ù‡Ù†Ø§ -->
      </div>

      <div class="price-section">
        <div class="price-label">Ø³Ø¹Ø± Ø§Ù„ØªØ°ÙƒØ±Ø©</div>
        <div class="price-amount">
          <span class="currency">Ø±ÙŠØ§Ù„</span>
          <span id="ticket-price"></span>
        </div>
      </div>

      <div class="description" id="description"></div>

      <div class="info-row">
        <span class="info-label">Ø§Ù„Ù…ÙˆÙ‚Ø¹:</span>
        <span id="location"></span>
      </div>
      <div class="info-row">
        <span class="info-label">Ù†ÙˆØ¹ Ø§Ù„ÙØ¹Ø§Ù„ÙŠØ©:</span>
        <span id="event-type"></span>
      </div>
      <div class="info-row">
        <span class="info-label">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©:</span>
        <span id="start-date"></span>
      </div>
      <div class="info-row">
        <span class="info-label">ØªØ§Ø±ÙŠØ® Ø§Ù„Ù†Ù‡Ø§ÙŠØ©:</span>
        <span id="end-date"></span>
      </div>

      <div class="map" id="map-container">
        <!-- Ø§Ù„Ø®Ø±ÙŠØ·Ø© Ø³ØªØ¶Ø§Ù Ù‡Ù†Ø§ -->
      </div>

      <div class="rating-section">
        <h3>Ù‚ÙŠÙ‘Ù… Ù‡Ø°Ù‡ Ø§Ù„ÙØ¹Ø§Ù„ÙŠØ©</h3>
        <div id="star-rating">
          <span class="star" data-value="1">â˜…</span>
          <span class="star" data-value="2">â˜…</span>
          <span class="star" data-value="3">â˜…</span>
          <span class="star" data-value="4">â˜…</span>
          <span class="star" data-value="5">â˜…</span>
        </div>
        <p id="rating-result">Ù„Ù… ÙŠØªÙ… Ø§Ù„ØªÙ‚ÙŠÙŠÙ… Ø¨Ø¹Ø¯</p>
      </div>

      <div class="comments">
        <h3>Ø§Ù„ØªØ¹Ù„ÙŠÙ‚Ø§Øª</h3>
        <ul id="comments-list"></ul>
        <div class="comment-form">
          <textarea id="comment-input" rows="3" placeholder="Ø§ÙƒØªØ¨ ØªØ¹Ù„ÙŠÙ‚Ùƒ..."></textarea>
          <button onclick="addComment()">Ø¥Ø±Ø³Ø§Ù„</button>
        </div>
      </div>

      <div class="action-buttons">
        <a id="homeLink">Ø§Ù„Ø±Ø¬ÙˆØ¹ Ù„Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
        <a href="#" id="book-btn">Ø­Ø¬Ø² Ø§Ù„Ø¢Ù†</a>
      </div>
    </div>

   <script>
      window.onload = function() {
        const urlParams = new URLSearchParams(window.location.search);
        const eventTitle = urlParams.get('title');
        
        if (eventTitle) {
          // Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„ÙØ¹Ø§Ù„ÙŠØ§Øª Ù…Ù† localStorage Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù…ÙØªØ§Ø­ Ø§Ù„ØµØ­ÙŠØ­ 'events'
          const events = JSON.parse(localStorage.getItem('events')) || [];
          // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„ÙØ¹Ø§Ù„ÙŠØ© Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø¹Ù†ÙˆØ§Ù†
          const event = events.find(e => e.title === eventTitle);
          
          if (event) {
            // Ø­ÙØ¸ index Ø§Ù„ÙØ¹Ø§Ù„ÙŠØ©
            event.index = events.indexOf(event);
            displayEventDetails(event);
          } else {
            showError("Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„ÙØ¹Ø§Ù„ÙŠØ©");
          }
        } else {
          showError("Ù…Ø±Ø¬Ø¹ Ø§Ù„ÙØ¹Ø§Ù„ÙŠØ© ØºÙŠØ± ØµØ­ÙŠØ­");
        }
      };

      function displayEventDetails(event) {
        const seatsKey = `activity_${event.index}_seats`;
        const availableSeats = parseInt(localStorage.getItem(seatsKey)) || event.seatsAvailable || 0;
        
        document.getElementById('event-title').textContent = event.title;
        document.getElementById('description').textContent = event.description;
        document.getElementById('location').textContent = event.location;
        document.getElementById('event-type').textContent = event.type;
        document.getElementById('start-date').textContent = event.startDate || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
        document.getElementById('end-date').textContent = event.endDate || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
        document.getElementById('ticket-price').textContent = event.ticketPrice || '0';

        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙˆØ±
        const imagesContainer = document.getElementById('images-container');
        imagesContainer.innerHTML = '';
        if (event.image) {
          const img = document.createElement('img');
          img.src = event.image;
          img.alt = event.title;
          imagesContainer.appendChild(img);
        }

        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø®Ø±ÙŠØ·Ø©
        const mapContainer = document.getElementById('map-container');
        if (event.location) {
          mapContainer.innerHTML = `
            <iframe
              src="https://www.google.com/maps?q=${encodeURIComponent(event.location)}&hl=ar&z=14&output=embed"
              allowfullscreen=""
              loading="lazy"
              referrerpolicy="no-referrer-when-downgrade">
            </iframe>`;
        }

        // ØªØ­Ø¯ÙŠØ« Ø²Ø± Ø§Ù„Ø­Ø¬Ø²
        const bookBtn = document.getElementById('book-btn');
        bookBtn.href = `pay.html?title=${encodeURIComponent(event.title)}&price=${event.ticketPrice}&seats=${availableSeats}&index=${event.index}`;

        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªØ¹Ù„ÙŠÙ‚Ø§Øª Ø§Ù„Ø®Ø§ØµØ© Ø¨Ø§Ù„ÙØ¹Ø§Ù„ÙŠØ©
        loadComments(event.index);
      }

      function loadComments(eventIndex) {
        const commentsKey = `activity_${eventIndex}_comments`;
        const comments = JSON.parse(localStorage.getItem(commentsKey)) || [];
        const commentsList = document.getElementById('comments-list');
        commentsList.innerHTML = '';
        
        if (comments.length === 0) {
          commentsList.innerHTML = '<li>Ù„Ø§ ØªÙˆØ¬Ø¯ ØªØ¹Ù„ÙŠÙ‚Ø§Øª Ø­ØªÙ‰ Ø§Ù„Ø¢Ù†</li>';
        } else {
          comments.forEach(comment => {
            const li = document.createElement('li');
            li.textContent = comment.text;
            const date = new Date(comment.date);
            const dateStr = date.toLocaleDateString('ar-SA');
            const timeStr = date.toLocaleTimeString('ar-SA');
            const dateSpan = document.createElement('div');
            dateSpan.style.fontSize = '12px';
            dateSpan.style.color = '#666';
            dateSpan.style.marginTop = '5px';
            dateSpan.textContent = `${dateStr} - ${timeStr}`;
            li.appendChild(dateSpan);
            commentsList.appendChild(li);
          });
        }
      }

      function addComment() {
        const input = document.getElementById('comment-input');
        const comment = input.value.trim();
        if (comment) {
          const urlParams = new URLSearchParams(window.location.search);
          const eventTitle = urlParams.get('title');
          const events = JSON.parse(localStorage.getItem('events')) || [];
          const event = events.find(e => e.title === eventTitle);
          
          if (event) {
            const eventIndex = events.indexOf(event);
            const commentsKey = `activity_${eventIndex}_comments`;
            const comments = JSON.parse(localStorage.getItem(commentsKey)) || [];
            
            comments.push({
              text: comment,
              date: new Date().toISOString()
            });
            
            localStorage.setItem(commentsKey, JSON.stringify(comments));
            loadComments(eventIndex);
            input.value = '';
          }
        } else {
          alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ ÙƒØªØ§Ø¨Ø© ØªØ¹Ù„ÙŠÙ‚ Ù‚Ø¨Ù„ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„');
        }
      }

      function showError(message) {
        document.getElementById('event-title').textContent = "Ø®Ø·Ø£";
        document.querySelector('.container').innerHTML = `<p style="text-align: center; color: red;">${message}</p>`;
      }

      function shareActivity() {
        const url = window.location.href;
        navigator.clipboard.writeText(url);
        alert("ØªÙ… Ù†Ø³Ø® Ø±Ø§Ø¨Ø· Ø§Ù„ÙØ¹Ø§Ù„ÙŠØ©! ÙŠÙ…ÙƒÙ†Ùƒ Ù…Ø´Ø§Ø±ÙƒØªÙ‡ Ø§Ù„Ø¢Ù†.");
      }

      function toggleLike() {
        const heartButton = document.querySelector(".heart-button");
        heartButton.classList.toggle("liked");
        heartButton.textContent = heartButton.classList.contains("liked") ? "â¤ï¸" : "ğŸ¤";
      }

      // Ù†Ø¸Ø§Ù… Ø§Ù„ØªÙ‚ÙŠÙŠÙ…
      let hasRated = false;
      document.querySelectorAll("#star-rating .star").forEach((star) => {
        star.addEventListener("click", function () {
          if (hasRated) {
            alert("Ù„Ù‚Ø¯ Ù‚Ù…Øª Ø¨Ø§Ù„ØªÙ‚ÙŠÙŠÙ… Ø¨Ø§Ù„ÙØ¹Ù„.");
            return;
          }
          const ratingValue = parseInt(this.getAttribute("data-value"));
          document.querySelectorAll("#star-rating .star").forEach((s) => {
            if (parseInt(s.getAttribute("data-value")) <= ratingValue) {
              s.classList.add("selected");
            }
          });
          document.getElementById("rating-result").textContent = `ØªÙ… Ø§Ù„ØªÙ‚ÙŠÙŠÙ…: ${ratingValue} Ù…Ù† 5 Ù†Ø¬ÙˆÙ…`;
          hasRated = true;
          alert("Ø´ÙƒØ±Ù‹Ø§ Ù„ØªÙ‚ÙŠÙŠÙ…Ùƒ!");
        });
      });

      // ØªØ­Ø¯ÙŠØ¯ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ù†ÙˆØ¹ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
      const userRole = localStorage.getItem("userRole");
      const homeLink = document.getElementById("homeLink");
      homeLink.href = userRole === "organizer" ? "eventlist.html" : "home.html";
</script>
  </body>
</html>
